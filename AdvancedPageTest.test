<?php
/**
 * @file
 * Advanced page test
 *
 * Copyright (c) 2010-2011 Board of Trustees, Leland Stanford Jr. University
 * This software is open-source licensed under the GNU Public License Version 2 or later
 * The full license is available in the LICENSE.TXT file at the root of this repository
 */
class AdvancedPageTest extends DrupalWebTestCase {

  function setUp() {
    parent::setUp('advanced_page');

    $this->own_user = $this->drupalCreateUser(array('create advanced_page content', 'edit own advanced_page content', 'delete own advanced_page content'));

    $this->OnlyViewList_user = $this->drupalCreateUser(array('view advanced page list'));
    $this->auntenticate_user = $this->drupalCreateUser();
  }

  public static function getInfo() {
    return array(
      'name' => 'Advanced Page functionality',
      'description' => 'Testing core functionality for advanced page',
      'group' => 'Advanced Page'
    );
  }

  /**
   * Test if the content type is created properly on install
   */
  function test_bundle() {
    $bundles = field_info_bundles('node');
    if(array_key_exists('advanced_page', $bundles)) {
      $this->assertTrue('Advanced page content type exists.');
    }
  }

  /**
   * Tests the permissions bases listing page
   */
  function test_ViewAdvancePageList() {

    // testing for authenticate user
    $this->drupalGet('admin/config/system/advanced-page');
    $this->assertResponse(403, t('Advanced page list is not accessible to anonymous user.'));
    $this->drupalLogout();

    // testing for authenticate user
    $this->drupalLogin($this->auntenticate_user);
    $this->drupalGet('admin/config/system/advanced-page');
    $this->assertResponse(403, t('Advanced page list is not accessible to auntenticate user without !perm.', array('!perm' => 'view advanced page list')));
    $this->drupalLogout();

    // testing with the users has the permission 'view advanced page list'
    $this->drupalLogin($this->OnlyViewList_user);
    $this->drupalGet('admin/config/system/advanced-page');
    $this->assertResponse(200, t('Advanced page list was displayed.'));
    $this->drupalLogout();
  }
}
